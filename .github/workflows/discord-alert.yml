name: Discord Alert on Push

on:
  push:
    branches:
      - main

jobs:
  alert:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord embed alert with commit message
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          GITHUB_ACTOR: ${{ github.actor }}
          GITHUB_REPO: ${{ github.repository }}
          GITHUB_SHA: ${{ github.sha }}
          GITHUB_COMMIT_MESSAGE: ${{ github.event.head_commit.message }}
        run: |
          curl -H "Content-Type: application/json" \
               -X POST \
               -d @- $DISCORD_WEBHOOK_URL <<EOF
{
  "embeds": [{
    "title": "ðŸš€ New Push to ${GITHUB_REPO}",
    "description": "**Author:** ${GITHUB_ACTOR}\n**Commit Message:** ${GITHUB_COMMIT_MESSAGE}\n[View Commit](https://github.com/${GITHUB_REPO}/commit/${GITHUB_SHA})",
    "color": 5814783
  }]
}
EOF
